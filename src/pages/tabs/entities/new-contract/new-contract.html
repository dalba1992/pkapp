<div class="menus">
  <ion-menu side="right" type="overlay" swipeEnabled=false [content]="mycontent" id="entity">
    <ion-header>
      <ion-row class="header-row">
        <ion-row class="header-title">
          <ion-col col-1>
          </ion-col>
          <span class="other-menu">
            Contract Group Name
          </span>
          <ion-col col-1 (click)="closeMenu()">
            <div class="right-icon">
              Done
            </div>
          </ion-col>
        </ion-row>
        <button ion-button class="normal-button round" color=opacity (click)="addNew()">Add new</button>
      </ion-row>
    </ion-header>

    <ion-content>
      <ion-spinner *ngIf="loadingEntities"></ion-spinner>
      <ng-container *ngIf="newContractFormStep1">
        <ion-row *ngIf="newEntityErrorMessage" text-wrap>
          <ion-col col-12>
            <ion-label color="danger">{{ newEntityErrorMessage }}</ion-label>
          </ion-col>
        </ion-row>
        <ion-row class="answer-row" *ngFor="let entity of entities" (click)="selectParentEntity(entity)">
          <ion-col col-10>
            <p [ngClass]="selectedEntity?.value?.id === entity.id ? 'que-title checked' : 'que-title'">{{ entity.name }}</p>
          </ion-col>
          <ion-col col-2>
            <ion-row *ngIf="selectedEntity?.value?.id === entity.id" class="check-row">
              <ion-icon name="ios-checkmark"></ion-icon>
            </ion-row>
          </ion-col>
        </ion-row>
      </ng-container>
    </ion-content>
  </ion-menu>
</div>

<ion-header>
  <ion-row class="header-row" (click)="goBack()">
    <ion-row class="header-title">
      <ion-col col-1>
        <ion-icon name="ios-arrow-back"></ion-icon>
      </ion-col>
      <span>
        New Contract
      </span>
      <ion-col col-1>
      </ion-col>
    </ion-row>
  </ion-row>
  <ion-row class="parent-entity" (click)="openMenu()">
    <ion-col col-1></ion-col>
    <ion-col col-10>
      <span class="title">
        Contract Group Name
      </span><br>
      <span class="detail" *ngIf="newContractFormStep1">{{ selectedEntity?.value?.name }}</span>
    </ion-col>
    <ion-col col-1>
      <ion-row class="align-center full-height">
        <ion-icon name="ios-arrow-forward"></ion-icon>
      </ion-row>
    </ion-col>
  </ion-row>
  <ion-row class="justify-center" padding>
    <svg *ngIf="stepIndex === 1" xmlns="http://www.w3.org/2000/svg" style="width: 100%" height="30.5"
      viewBox="0 0 282.754 30.5">
      <g id="Group_1029" data-name="Group 1029" transform="translate(-42.764 -179.5)">
        <g id="Ellipse_8" data-name="Ellipse 8" transform="translate(295 179.5) rotate(90)" fill="#8ADB20"
          stroke="rgba(255,255,255,0.2)" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <g id="Ellipse_10" data-name="Ellipse 10" transform="translate(194 179.5) rotate(90)" fill="#8ADB20"
          stroke="rgba(255,255,255,0.2)" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <g id="Ellipse_9" data-name="Ellipse 9" transform="translate(81 179.5) rotate(90)" fill="#8ADB20"
          stroke="#8ADB20" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <line id="Line_29" data-name="Line 29" x1="100" transform="translate(81.5 186)" fill="none"
          stroke="rgba(255,255,255,0.4)" stroke-linecap="round" stroke-width="1.5" stroke-dasharray="1 5" />
        <line id="Line_30" data-name="Line 30" x1="85" transform="translate(194.5 186)" fill="none"
          stroke="rgba(255,255,255,0.4)" stroke-linecap="round" stroke-width="1.5" stroke-dasharray="1 5" />
        <text id="Contact_info" data-name="Contact info" transform="translate(74.764 207)" fill="#8ADB20" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-31.705" y="0">Contract Type</tspan>
        </text>
        <text id="Locations" transform="translate(188 207)" fill="rgba(255,255,255,0.4)" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-30.88" y="0">Contact Info</tspan>
        </text>
        <text id="Contract_info" transform="translate(300.518 207)" fill="rgba(255,255,255,0.4)" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-44.925" y="0">Locations</tspan>
        </text>
      </g>
    </svg>
    <svg *ngIf="stepIndex === 2" xmlns="http://www.w3.org/2000/svg" style="width: 100%" height="30.5"
      viewBox="0 0 282.754 30.5">
      <g id="Group_1030" data-name="Group 1030" transform="translate(-42.764 -179.5)">
        <g id="Ellipse_8" data-name="Ellipse 8" transform="translate(295 179.5) rotate(90)" fill="#8ADB20"
          stroke="rgba(255,255,255,0.2)" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <g id="Ellipse_10" data-name="Ellipse 10" transform="translate(194 179.5) rotate(90)" fill="#8ADB20"
          stroke="#8ADB20" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <g id="Ellipse_9" data-name="Ellipse 9" transform="translate(81 179.5) rotate(90)" fill="#8ADB20"
          stroke="#8ADB20" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <line id="Line_29" data-name="Line 29" x1="100" transform="translate(81.5 186)" fill="none" stroke="#8ADB20"
          stroke-linecap="round" stroke-width="1.5" stroke-dasharray="1 5" />
        <line id="Line_30" data-name="Line 30" x1="85" transform="translate(194.5 186)" fill="none"
          stroke="rgba(255,255,255,0.4)" stroke-linecap="round" stroke-width="1.5" stroke-dasharray="1 5" />
        <text id="Contact_info" data-name="Contact info" transform="translate(74.764 207)" fill="#8ADB20" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-31.705" y="0">Contract Type</tspan>
        </text>
        <text id="Locations" transform="translate(188 207)" fill="#8ADB20" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-30.88" y="0">Contact Info</tspan>
        </text>
        <text id="Contract_info" transform="translate(300.518 207)" fill="rgba(255,255,255,0.4)" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-44.925" y="0">Locations</tspan>
        </text>
      </g>
    </svg>
    <svg *ngIf="stepIndex === 3 || stepIndex === 4" xmlns="http://www.w3.org/2000/svg" style="width: 100%" height="30.5"
      viewBox="0 0 282.754 30.5">
      <g id="Group_1031" data-name="Group 1031" transform="translate(-42.764 -179.5)">
        <g id="Ellipse_8" data-name="Ellipse 8" transform="translate(295 179.5) rotate(90)" fill="#8ADB20"
          stroke="#8ADB20" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <g id="Ellipse_10" data-name="Ellipse 10" transform="translate(194 179.5) rotate(90)" fill="#8ADB20"
          stroke="#8ADB20" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <g id="Ellipse_9" data-name="Ellipse 9" transform="translate(81 179.5) rotate(90)" fill="#8ADB20"
          stroke="#8ADB20" stroke-width="1.5">
          <circle cx="6.5" cy="6.5" r="6.5" stroke="none" />
          <circle cx="6.5" cy="6.5" r="5.75" fill="none" />
        </g>
        <line id="Line_29" data-name="Line 29" x1="100" transform="translate(81.5 186)" fill="none" stroke="#8ADB20"
          stroke-linecap="round" stroke-width="1.5" stroke-dasharray="1 5" />
        <line id="Line_30" data-name="Line 30" x1="85" transform="translate(194.5 186)" fill="none" stroke="#8ADB20"
          stroke-linecap="round" stroke-width="1.5" stroke-dasharray="1 5" />
        <text id="Contact_info" data-name="Contact info" transform="translate(74.764 207)" fill="#8ADB20" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-31.705" y="0">Contract Type</tspan>
        </text>
        <text id="Locations" transform="translate(188 207)" fill="#8ADB20" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-30.88" y="0">Contact Info</tspan>
        </text>
        <text id="Contract_info" transform="translate(300.518 207)" fill="#8ADB20" font-size="10"
          font-family="Montserrat-SemiBold, Montserrat" font-weight="600">
          <tspan x="-44.925" y="0">Locations</tspan>
        </text>
      </g>
    </svg>
  </ion-row>
</ion-header>

<ion-content #mycontent>
  <ion-spinner *ngIf="loading"></ion-spinner>
  <div *ngIf="!loading">
    <form [formGroup]="newContractFormStep1" *ngIf="newContractFormStep1">
      <div *ngIf="stepIndex === 1">
        <div class="step-btn">
          <h3>Contract Type</h3>
          <h5 text-center>Is there an active contract for your location(s)?</h5>
          <div class="step-btn">
            <ion-row>
              <ion-col col-6>
                <button class="normal-button" ion-button color=secondary (click)="showExpiration()">Yes</button>
              </ion-col>
              <ion-col col-6>
                <button class="normal-button" ion-button color=danger (click)="noShowExpiration()">No</button>
              </ion-col>
            </ion-row>
          </div>
          <div class="step-btn" *ngIf="showNextStep && isActiveContract">
            <div class="input-box-md">
              <ion-row>
                <span>What is the Expiration Date?</span>
              </ion-row>
              <mat-form-field class="full-width" (click)="openCalendar()">
                <input matInput type="text" placeholder="Expiration Date" formControlName="expirationDate">
              </mat-form-field>
            </div>
            <ion-row *ngIf="step1ErrorMessage" text-wrap>
              <ion-col col-12>
                <ion-label color="danger">{{ step1ErrorMessage }}</ion-label>
              </ion-col>
            </ion-row>
            <ion-item text-wrap *ngIf="startStep1Validation && !expirationDate.valid && (expirationDate.dirty || expirationDate.touched)">
              <ion-label color="danger">Please choose the expiration date of your contract.</ion-label>
            </ion-item>
            <ion-row>
              <ion-col col-12>
                <button class="normal-button" ion-button color=secondary (click)="next()">Next Step</button>
              </ion-col>
            </ion-row>
          </div>
          <div class="step-btn" *ngIf="showNextStep && !isActiveContract">
            <div class="input-box-md">
              <ion-row>
                <span text-center>Perfect! We're ready to move forward then!</span>
              </ion-row>
            </div>
            <ion-row>
              <ion-col col-12>
                <button class="normal-button" ion-button color=secondary (click)="next()">Next Step</button>
              </ion-col>
            </ion-row>
          </div>
        </div>
      </div>
    </form>
    <form [formGroup]="newContractFormStep2" *ngIf="newContractFormStep2">
      <div *ngIf="stepIndex === 2">
        <div class="input-box-md">
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Legal Entity Name" formControlName="DBAName">
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Contact First Name" formControlName="firstName" required>
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Contact Last Name" formControlName="lastName" required>
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Title" formControlName="title">
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="email" placeholder="Email" formControlName="email" required>
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="tel" placeholder="Mobile Phone" formControlName="phone" [textMask]="{ mask: Constants.masks.phone }" required>
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="tel" placeholder="Direct Office Phone" formControlName="phone2" [textMask]="{ mask: Constants.masks.phone }">
          </mat-form-field>
          <mat-form-field class="full-width" *ngIf="serviceTypes">
            <mat-select formControlName="serviceType" placeholder="Contract Service Type" required>
              <mat-option *ngFor="let serviceType of serviceTypes" [value]="serviceType">
                {{ serviceType.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <h5>Billing Address</h5>
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Address" formControlName="billingAddress1" required>
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Apt, Suite" formControlName="billingAddress2">
          </mat-form-field>
          <mat-form-field class="full-width">
            <input matInput type="text" placeholder="Zip Code" formControlName="billingZipCode" (keyup)="getBillingZipCode()" maxlength="5" required>
          </mat-form-field>
          <ion-label color="info" *ngIf="loadingBillingZipCode">Validating zip code...</ion-label>
          <ion-row *ngIf="billingZipCodeErrorMessage" text-wrap>
            <ion-col col-12>
              <ion-label color="danger">{{ billingZipCodeErrorMessage }}</ion-label>
            </ion-col>
          </ion-row>
          <ion-spinner *ngIf="loadingBillingZipCode"></ion-spinner>
          <mat-form-field class="full-width" *ngIf="!loadingBillingZipCode && billingCitiesInZipCode">
            <mat-select formControlName="billingCity" placeholder="City" required>
              <mat-option *ngFor="let city of billingCitiesInZipCode" [value]="city">
                {{ city }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="full-width" *ngIf="!loadingBillingZipCode && billingStateID.value && billingStateID.value != 'null'">
            <input matInput type="text" placeholder="State" formControlName="billingStateShort">
          </mat-form-field>
        </div>

        <ion-row *ngIf="step2ErrorMessage" text-wrap>
          <ion-col col-12>
            <ion-label color="danger">{{ step2ErrorMessage }}</ion-label>
          </ion-col>
        </ion-row>

        <ion-item text-wrap *ngIf="startStep2Validation && !firstName.valid && (firstName.dirty || firstName.touched)">
          <ion-label color="danger">Please enter your first name.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !lastName.valid && (lastName.dirty || lastName.touched)">
          <ion-label color="danger">Please enter your last name.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !email.valid && (email.dirty || email.touched)">
          <ion-label color="danger">Please enter your email.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !phone.valid && (phone.dirty || phone.touched)">
          <ion-label color="danger">Please enter a valid phone number.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !phone2.valid && (phone2.dirty || phone2.touched)">
          <ion-label color="danger">Please enter a valid company phone number.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !billingAddress1.valid && (billingAddress1.dirty || billingAddress1.touched)">
          <ion-label color="danger">Please enter your billing address.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !billingCity.valid && (billingCity.dirty || billingCity.touched)">
          <ion-label color="danger">Please choose a city.</ion-label>
        </ion-item>

        <ion-item text-wrap *ngIf="startStep2Validation && !billingZipCodeValid.valid && (billingZipCodeValid.dirty || billingZipCodeValid.touched)">
          <ion-label color="danger">Please input a valid billing zip code.</ion-label>
        </ion-item>

        <div class="step-btn">
          <ion-row>
            <ion-col col-6>
              <button class="normal-button" ion-button color=secondary [disabled]="loadingZipCode || loadingBillingZipCode" (click)="previous()">Previous step</button>
            </ion-col>
            <ion-col col-6>
              <button class="normal-button" ion-button color=danger [disabled]="loadingZipCode || loadingBillingZipCode" (click)="next()">Next step</button>
            </ion-col>
          </ion-row>
        </div>
      </div>
    </form>
    <form [formGroup]="newContractFormStep3" *ngIf="newContractFormStep3">
      <div *ngIf="stepIndex === 3" class="step-3-wrap">
        <ng-container formArrayName="locations" *ngFor="let location of locations.controls; let i = index;">
          <div class="card-wrap">
            <ion-card [formGroupName]="i">
              <ion-row>
                <ion-col class="left-col" no-padding col-2 (click)="removeLocation(locations, i)">
                  <ion-row class="full-height">
                    <cancel-icon></cancel-icon>
                  </ion-row>
                </ion-col>
                <ion-col no-padding col-10>
                  <ion-row class="go-arrow-configure" (click)="goEditLocation(location, i)">
                    <div>
                      <span>Address</span><br>
                      <span class="des">{{ location.get('address1').value }} {{ location.get('address2').value }}</span><br>
                      <span class="des">{{ location.get('city').value }}, {{ location.get('stateShort').value }} {{ location.get('zipCode').value }}</span>
                    </div>
                  </ion-row>
                </ion-col>
              </ion-row>
            </ion-card>
          </div>
        </ng-container>
        <div class="card-wrap">
          <button ion-button class="normal-button" color="primary" (click)="goAddLocation()">Add Location</button>
        </div>
        <ion-item text-wrap *ngIf="startStep2Validation && !locations.valid && (locations.dirty || locations.touched)">
          <ion-label color="danger">Please enter at least one valid contract location.</ion-label>
        </ion-item>
        <div class="step-btn">
          <ion-row>
            <ion-col col-6>
              <button class="normal-button" ion-button color=secondary (click)="previous()">Previous step</button>
            </ion-col>
            <ion-col col-6>
              <button class="normal-button" ion-button color=danger (click)="goAuction()">Go To Auction</button>
            </ion-col>
          </ion-row>
        </div>
      </div>
    </form>
  </div>
</ion-content>